<!DOCTYPE html>
<html lang="en">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-7KV1XDEBW2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-7KV1XDEBW2');
</script>
  
  <meta charset="utf-8"/>
  <title>Schedule Your Fleet Refueling</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <!-- Font setup to match fleet-commercial -->
  <script src="https://c.webfontfree.com/c.js?f=ArchitypeTschicholdW90" type="text/javascript"></script>
  <link href="https://fonts.googleapis.com" rel="preconnect"/>
  <link crossorigin href="https://fonts.gstatic.com" rel="preconnect"/>
  <link href="https://fonts.googleapis.com/css2?family=Maiden+Orange&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Poppins:wght@500;700&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet"/>
  <link href="styles.css" rel="stylesheet"/>
  <link href="nav.css" rel="stylesheet"/>
  <script defer src="nav-loader.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
  <style>
    /* Global font styling */
    body, h1, h2, h3, h4, h5, h6, p, a, li, span, input, button {
      font-family: 'Nunito', 'Inter', sans-serif !important;
      -webkit-font-smoothing: antialiased;
    }
    .lookup-container { max-width: 800px; margin: 60px auto; padding: 30px; background: #333; color: #D3D3D3; border-radius: 15px; box-shadow: 0 0 15px rgba(0,0,0,0.2); }
    h2 { text-align: center; color: #00ccff; margin-bottom: 20px; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 20px; background-color: #2a2a2a; border: 1px solid #4a6333; border-radius: 10px; overflow: hidden; }
    th, td { padding: 12px; text-align: left; border-bottom: 1px solid #4a6333; }
    th { background-color: #01426a; color: white; }
    input[type=text], input[type=email] { width: 100%; padding: 8px; background-color: #1e1e1e; color: #d3d3d3; border: 1px solid #4a6333; border-radius: 5px; }
    button { background-color: #00ccff; color: white; border: none; padding: 8px 14px; border-radius: 6px; cursor: pointer; }
    button:hover { background-color: #0099cc; }
    .confirmation-container { display: none; text-align: center; margin-top: 20px; color: #00ccff; }
    .confirmation-container h2 { margin-bottom: 10px; }
    .confirmation-container p { color: #d3d3d3; }
  </style>
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAh5XxodKgwBLU3RipuMvQr-WwsqVN12w8&libraries=places"></script>
</head>
<body>
  <main class="page-content">
    <div class="lookup-container">
      <h2>Schedule Your Fleet Refueling</h2>
      <form id="rescheduleForm">
        <label for="email">Email:</label>
        <input id="email" name="Email" type="email" placeholder="Enter your email" required/><br/>
        <label for="pin">6-Digit PIN:</label>
        <input id="pin" name="Pin" type="text" placeholder="Enter your 6-digit PIN" maxlength="6" pattern="\d{6}" required/><br/>
        <button type="submit">Next</button>
      </form>
      <div id="fleetTableContainer" style="display:none;">
        <h2>Vehicle Refueling Table - <span id="currentDate"></span></h2>
        <table id="dynamicTable">
          <thead><tr><th>Car Make</th><th>Car Model</th><th>Car Year</th><th>License Plate</th><th>Action</th></tr></thead>
          <tbody>
            <tr>
              <td><input type="text" placeholder="Make"/></td>
              <td><input type="text" placeholder="Model"/></td>
              <td><input type="text" placeholder="Year"/></td>
              <td><input type="text" placeholder="Plate"/></td>
              <td><button onclick="removeRow(this)">Remove</button></td>
            </tr>
          </tbody>
        </table>
        <button onclick="addRow()">Add Row</button>
        <div style="text-align: right; margin-top: 20px;"><button onclick="saveAndSubmit()">Save & Submit</button></div>
      </div>
      <div id="confirmationContainer" class="confirmation-container">
        <h2>Success! Your mobile fueling is scheduled.</h2>
        <p>We’ll be at your lot on <span id="confirmDate"></span> between 4:00 PM and 6:00 PM.<br/>Expect a text update 30 minutes before we arrive. Need to reschedule? Email us at <a href="mailto:support@gasmeupservices.com" style="color: #38b6ff;">support@gasmeupservices.com</a>.</p>
      </div>
    </div>
    <script>
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('currentDate').innerText = today;
      document.getElementById('confirmDate').innerText = today;
      document.getElementById('rescheduleForm').addEventListener('submit', function(e) {
        e.preventDefault();
        this.style.display='none';
        document.getElementById('fleetTableContainer').style.display='block';
      });
      function addRow() {
        const tbody = document.querySelector('#dynamicTable tbody');
        const row = document.createElement('tr');
        row.innerHTML = `<td><input type="text" placeholder="Make"/></td><td><input type="text" placeholder="Model"/></td><td><input type="text" placeholder="Year"/></td><td><input type="text" placeholder="Plate"/></td><td><button onclick="removeRow(this)">Remove</button></td>`;
        tbody.appendChild(row);
      }
      function removeRow(btn) { btn.closest('tr').remove(); }
      function saveAndSubmit() {
  const GAS_URL = 'https://script.google.com/macros/s/AKfycbzH3VkNS1tuD5LLGs5RZ51ZzQIwF8No5iueuBkaQrlr1SdNSWxc49sTUH0VNDyg5RJJ2Q/exec'
  const submitBtn = Array.from(document.querySelectorAll('button')).find(b => /Save\s*&\s*Submit/i.test(b.textContent));
  const statusEl = document.getElementById('status');
  function setStatus(msg) { if (statusEl) statusEl.textContent = msg; }

  const email = (document.getElementById('email')?.value || '').trim();
  const pin = (document.getElementById('pin')?.value || '').trim();
  const serviceDate = (document.getElementById('currentDate')?.innerText || '').trim();
  if (!email) { alert('Email is required.'); return; }
  if (!/^\d{6}$/.test(pin)) { alert('PIN must be exactly 6 digits.'); return; }

  const rows = document.querySelectorAll('#dynamicTable tbody tr');
  const data = Array.from(rows).map(row => {
    const inputs = row.querySelectorAll('input');
    return {
      make: (inputs[0]?.value || '').trim(),
      model: (inputs[1]?.value || '').trim(),
      year: (inputs[2]?.value || '').trim(),
      plate: (inputs[3]?.value || '').trim()
    };
  }).filter(r => r.make || r.model || r.year || r.plate);
  if (!data.length) { alert('Please add at least one vehicle row before submitting.'); return; }
  const badYear = data.find(d => d.year && !/^\d{4}$/.test(d.year));
  if (badYear) { alert('Year must be 4 digits (e.g., 2022).'); return; }
  if (!confirm('Are you sure you want to submit?')) return;

  if (submitBtn) submitBtn.disabled = true;
  setStatus('Submitting to Google Sheets...');

  const payload = { email, pin, serviceDate, rows: data };
  // Fire-and-forget to avoid CORS: we cannot read the response, but the request will be sent.
  fetch(GAS_URL, {
    method: 'POST',
    mode: 'no-cors',
    headers: { 'Content-Type': 'text/plain;charset=utf-8' },
    body: JSON.stringify(payload)
  })
  .then(() => {
    // We won't know success/failure; assume success for UX.
    setStatus('Submitted (sent without reading response).');
    document.querySelectorAll('.lookup-container > *:not(#confirmationContainer)').forEach(el => el.style.display = 'none');
    document.getElementById('confirmationContainer').style.display = 'block';
    const confirmDateEl = document.getElementById('confirmDate');
    if (confirmDateEl && serviceDate) confirmDateEl.innerText = serviceDate;
    alert('Submitted! Your refueling list was sent.');
  })
  .catch(err => {
    console.error(err);
    setStatus('There was an error initiating the request. See console for details.');
    alert('Error: request could not be initiated.');
  })
  .finally(() => { if (submitBtn) submitBtn.disabled = false; });
}
    </script>
  </main>
  <div class="bottom-nav">
    <a class="nav-link" href="home"><i class="fas fa-home"></i>Home</a>
    <a class="nav-link" href="steps"><i class="fas fa-gas-pump"></i>How It Works</a>
    <a class="nav-link" href="pricing"><i class="fas fa-dollar-sign"></i>Pricing</a>
    <a class="nav-link" href="contact"><i class="fas fa-envelope"></i>Contact</a>
  </div>
</body>
</html>
